WATCHDELTAGS []
WATCHTAGS [ "Static" ]

# Add feed
SETCONFIGS { "Feed Static" : { "url" : "file:///tmp/canto.xml" } }
REMOTE_WAIT 5
(u'TAGCHANGE', u'Static')
(u'TAGCHANGE', u'Static')
(u'TAGCHANGE', u'Static')
(u'TAGCHANGE', u'Static')
(u'TAGCHANGE', u'Static')

# Get ITEMS so that the daemon will consider them protected.
ITEMS [ "Static" ]
REMOTE_WAIT 1
(u'ITEMS',
 {'Static': [(u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/94'),
             (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/93'),
             (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/92'),
             (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/91'),
             (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/90')]})

# Remove the feed.
SETCONFIGS { "Feed Static" : None }
REMOTE_WAIT 2
(u'TAGCHANGE', u'Static')
(u'DELTAGS', [u'Static'])

# This should still work, because they're committed.
ATTRIBUTES { (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/94') : [ "title" ] }
REMOTE_WAIT 1
(u'ATTRIBUTES',
 {(u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/94'): {'title': u'Update'}})

# However this shouldn't have the "Static" feed
LISTFEEDS []
REMOTE_WAIT 1
(u'LISTFEEDS',
 [(u'Canto', u'http://codezen.org/static/canto.xml'),
  (u'Slashdot', u'http://rss.slashdot.org/slashdot/Slashdot'),
  (u'Reddit', u'http://reddit.com/.rss')])
# This should no longer work because the items should've been eliminated.
ATTRIBUTES { (u'file:///tmp/canto.xml', u'http://codezen.org/canto/news/94') : [ "title" ] }
REMOTE_WAIT 1
(u'EXCEPT', Exception(u"Can't find feed: file:///tmp/canto.xml",))
