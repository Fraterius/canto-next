WATCHTAGS [ "maintag\\:Static" ]

# Add feed
SETCONFIGS { "Feed Static" : { "url" : "file:///tmp/canto-short.xml" } }
UPDATE {}

# One TAGCHANGE for added items
REMOTE_WAIT 1
(u'TAGCHANGE', u'maintag\\:Static')

ITEMS [ "maintag\\:Static" ]
REMOTE_WAIT 1
(u'ITEMS',
 {'maintag\\:Static': [(u'file:///tmp/canto-short.xml',
                        u'http://codezen.org/canto/news/92'),
                       (u'file:///tmp/canto-short.xml',
                        u'http://codezen.org/canto/news/91'),
                       (u'file:///tmp/canto-short.xml',
                        u'http://codezen.org/canto/news/90')]})

# Switch the filter.
SETCONFIGS { "defaults" : { "global_transform" : "filter_read" } }

# One TAGCHANGE from config reset (items removed from tag)
REMOTE_WAIT 1
(u'TAGCHANGE', u'maintag\\:Static')

# Set an item to be filtered by filter_read
SETATTRIBUTES { (u'file:///tmp/canto-short.xml', u'http://codezen.org/canto/news/92') : { "canto-state" : [ "read" ]} }

# Wait on TAGCHANGE from filter.
REMOTE_WAIT 1
(u'TAGCHANGE', u'maintag\\:Static')

# Change URL to longer feed should get TAGCHANGE for adding.
SETCONFIGS { "Feed Static" : { "url" : "file:///tmp/canto-long.xml" }}
UPDATE {}

# Two TAGCHANGES, one from reset (items removed from tag), one from new items.
REMOTE_WAIT 2
(u'TAGCHANGE', u'maintag\\:Static')
(u'TAGCHANGE', u'maintag\\:Static')

ITEMS [ "maintag\\:Static" ]
REMOTE_WAIT 1
(u'ITEMS',
 {'maintag\\:Static': [(u'file:///tmp/canto-long.xml',
                        u'http://codezen.org/canto/news/94'),
                       (u'file:///tmp/canto-long.xml',
                        u'http://codezen.org/canto/news/93'),
                       (u'file:///tmp/canto-long.xml',
                        u'http://codezen.org/canto/news/92'),
                       (u'file:///tmp/canto-long.xml',
                        u'http://codezen.org/canto/news/91'),
                       (u'file:///tmp/canto-long.xml',
                        u'http://codezen.org/canto/news/90')]})
